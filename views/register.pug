extends _layout

block content
  .section.container-center
    .login-container.center.width-max-350.b-white.rounded-12.padding-all-20.padding-top-40.padding-bottom-40.z-depth-2
      img.margin-bottom-30(src="/img/logo.png")
      p.t-big Register your account
      form#registerForm.row
        .input-field.col.s12.no-margin-top.margin-bottom-10
          label(for="name") Name
          input#loginName.validate(type="text" required)
        .input-field.col.s12.no-margin-top.margin-bottom-10
          label(for="email") E-mail
          input#loginUser.validate(type="email" required)
        .input-field.col.s12.no-margin
          label(for="password") Password
          input#loginPass.validate(type="password" required)
        button#loginSubmit.margin-top-30.btn-large.b-blue-1.waves-effect.waves-light.col.s8.offset-s2(type="submit") 
          | Register
      p
        a.t-gray-1(href="/") Already have an account? Log In!
      p.margin-top-20
        a#loginOut.t-gray-1(href="#") [DEBUG] Log Out

block additional_scripts
  script.
    firebase.auth().onAuthStateChanged(function(user) {
      window.user = user;
      console.log('user => ',user);
    });
    
    var database = firebase.database();

    $("#registerForm").submit(function(e) {
      e.preventDefault();
      e.stopPropagation();
      console.log('Login In...');
      var email = $("#loginUser").val();
      var password = $("#loginPass").val();
      firebase.auth().createUserWithEmailAndPassword(email, password).then(function(){
        var newUID = firebase.auth().currentUser.uid;
        console.log('Registered and Logged In...');
        console.log('currentUID => ',newUID); 
        if (newUID) {
          var name = $("#loginName").val();
          firebase.database().ref('users/' + newUID).set({
            name: name,
            email: email
          });
          window.location.href = "/home";
        } else {
            M.Toast.dismissAll();
            M.toast({html: "Incorrect Fields", classes: 'toast-alert', displayLength: 3000});
        }
      }).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // [START_EXCLUDE]
        if (errorCode == 'auth/weak-password') {
          alert('The password is too weak.');
        } else {
          alert(errorMessage);
        }
        console.log(error);
        // [END_EXCLUDE]
      });
    });